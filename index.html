
<!DOCTYPE html>
<html>
<head>
  <title>Peta dan Grafik Mitra Pendidikan</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    #map { height: 60vh; }
    .charts { display: flex; flex-wrap: wrap; justify-content: space-around; padding: 10px; }
    .chart-box { width: 400px; margin: 10px; }
  </style>
</head>
<body>

<div id="map"></div>

<div class="charts">
  <div class="chart-box">
    <canvas id="genderChart"></canvas>
  </div>
  <div class="chart-box">
    <canvas id="programChart"></canvas>
  </div>
  <div class="chart-box">
    <canvas id="wilayahChart"></canvas>
  </div>
  <div class="chart-box">
    <canvas id="sukuChart"></canvas>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
  // Peta Leaflet
  var map = L.map('map').setView([-2.5, 133], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  fetch('Mitra_Pendidikan_Final.geojson')
    .then(res => res.json())
    .then(data => {
      var markers = L.markerClusterGroup();
      var geojsonLayer = L.geoJSON(data, {
        onEachFeature: function (feature, layer) {
          const p = feature.properties;
          const popup = `<strong>${p['NAMA MITRA PENDIDIKAN']}</strong><br>
          Program: ${p['PROGRAM']}<br>
          Wilayah: ${p['WILAYAH']}<br>
          Mahasiswa: ${p['JUMLAH MAHASISWA']}<br>
          Laki-laki: ${p['LAKI-LAKI']}<br>
          Perempuan: ${p['PEREMPUAN']}`;
          layer.bindPopup(popup);
        }
      });
      markers.addLayer(geojsonLayer);
      map.addLayer(markers);
    });

  // Grafik Chart.js
  fetch('chart_data.json')
    .then(res => res.json())
    .then(data => {
      new Chart(document.getElementById("genderChart"), {
        type: "pie",
        data: {
          labels: Object.keys(data.gender),
          datasets: [{ data: Object.values(data.gender), backgroundColor: ['#007bff', '#ff6384'] }]
        },
        options: { plugins: { title: { display: true, text: 'Distribusi Gender' } } }
      });

      new Chart(document.getElementById("programChart"), {
        type: "pie",
        data: {
          labels: Object.keys(data.program),
          datasets: [{ data: Object.values(data.program), backgroundColor: ['#28a745', '#ffc107'] }]
        },
        options: { plugins: { title: { display: true, text: 'Distribusi Program' } } }
      });

      new Chart(document.getElementById("wilayahChart"), {
        type: "pie",
        data: {
          labels: Object.keys(data.wilayah),
          datasets: [{ data: Object.values(data.wilayah), backgroundColor: Object.keys(data.wilayah).map((_,i)=>`hsl(${i*30},70%,60%)`) }]
        },
        options: { plugins: { title: { display: true, text: 'Distribusi Wilayah' } } }
      });

      const sukuLabels = Object.keys(data.suku_by_program["BEASISWA UMUM"]);
      const umumValues = sukuLabels.map(s => data.suku_by_program["BEASISWA UMUM"][s] || 0);
      const khususValues = sukuLabels.map(s => data.suku_by_program["BEASISWA KHUSUS"][s] || 0);
      new Chart(document.getElementById("sukuChart"), {
        type: "bar",
        data: {
          labels: sukuLabels,
          datasets: [
            { label: "Umum", data: umumValues, backgroundColor: "#36a2eb" },
            { label: "Khusus", data: khususValues, backgroundColor: "#ff6384" }
          ]
        },
        options: {
          plugins: { title: { display: true, text: 'Jumlah Mahasiswa per Suku' } },
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    });
</script>

</body>
</html>
